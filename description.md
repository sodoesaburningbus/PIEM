# Iowa Environmental Mesonet (IEM) ASOS API Wrapper

This Python module provides a wrapper for the **Iowa Environmental Mesonet (IEM)** API, specifically focused on accessing the **Automated Surface Observing System (ASOS)** network.

The wrapper simplifies the process of downloading and manipulating ASOS meteorological data using a user-friendly Python interface.

---

## Author
**Christopher Phillips**  
Valparaiso University  
(This markdown file generated by ChatGPT)
---

## Overview

The `api` class provides functionality to query ASOS data through IEM’s REST API.  
Users can define a time range, select a station, and specify which meteorological variables to include in the data download.

The result is returned as a `pandas.DataFrame` (`self.obs`) for easy data analysis and visualization.

---

## Dependencies

This module requires the following Python libraries:

```python
pandas
numpy
```

---

## Class: `api`

### Description

The `api` class constructs an API call to the IEM ASOS service, retrieves observations, and processes them into a cleaned DataFrame.

---

### **Initialization**

```python
api(
    start_date, 
    end_date=None,
    tmpf=True, dwpf=True, drct=True, sknt=True, mslp=True,
    ave_wind_speed_kts=False, ave_wind_drct=False, relh=False, p01i=False, 
    alti=False, vsby=False, gust=False, skyc1=False, skyc2=False, skyc3=False, 
    skyc4=False, skyl1=False, skyl2=False, skyl3=False, skyl4=False, wxcodes=False, 
    ice_accretion_1hr=False, ice_accretion_3hr=False, ice_accretion_6hr=False, 
    peak_wind_gust=False, peak_wind_drct=False, peak_wind_time=False, feel=False, 
    metar=False, snowdepth=False, special=False, all=False, station=None
)
```

#### **Parameters**

| Name | Type | Default | Description |
|------|------|----------|-------------|
| `start_date` | `datetime` | — | Earliest date for data retrieval (UTC). |
| `end_date` | `datetime` | `start_date` | Latest date for data retrieval (UTC). |
| `station` | `str` | `None` | Optional station identifier (e.g., `"ORD"`). If blank, retrieves all stations. |
| `special` | `bool` | `False` | Include special METAR observations if `True`. |
| `all` | `bool` | `False` | If `True`, all available variables are downloaded. |
| Various flags | `bool` | Default `False` | Flags for selecting specific variables (temperature, wind speed, etc.). The defaults represent minimal meteorological data fields (temperature, dewpoint, wind direction, wind speed, and MSLP). |

---

#### **Attributes**

| Attribute | Type | Description |
|------------|------|-------------|
| `obs` | `pandas.DataFrame` | DataFrame containing the downloaded ASOS observations. |
| `api_call` | `str` | The full URL used to call the IEM API. |

---

### **Example Usage**

```python
from datetime import datetime
from iem_wrapper import api

# Create an API object for ORD station on Nov 1, 2024
asos = api(
    start_date=datetime(2024, 11, 1),
    end_date=datetime(2024, 11, 2),
    station='ORD'
)

# View the downloaded data
print(asos.obs.head())

# Access the API URL
print(asos.api_call)
```

---

## Methods

### **`extract_hour(hour)`**

Extracts all observations from the dataset that correspond to a specific UTC hour.

```python
extract_hour(hour)
```

#### **Parameters**

| Name | Type | Description |
|------|------|-------------|
| `hour` | `int` | UTC hour (0–23) to extract. |

#### **Returns**

| Type | Description |
|------|-------------|
| `pandas.DataFrame` | Subset of observations rounded to the nearest hour. |

#### **Example**

```python
hourly_data = asos.extract_hour(12)
print(hourly_data)
```

---

### **`cloud_eigths(cloud_text)`**

Converts textual cloud cover codes (e.g., `'FEW'`, `'BKN'`) into integer eighths for quantitative analysis.

```python
cloud_eigths(cloud_text)
```

#### **Parameters**

| Name | Type | Description |
|------|------|-------------|
| `cloud_text` | `numpy.ndarray` | Array of cloud cover text codes. |

#### **Returns**

| Type | Description |
|------|-------------|
| `numpy.ndarray` | Integer array representing sky cover in eighths (0–8). |

#### **Code Mapping**

| Code | Meaning | Eighths |
|------|----------|----------|
| `SKC` / `NSC` | Clear | 0 |
| `FEW` | Few clouds | 1 |
| `SCT` | Scattered clouds | 3 |
| `BKN` | Broken clouds | 6 |
| `OVC` | Overcast | 8 |

#### **Example**

```python
clouds = np.array(['FEW', 'SCT', 'OVC'])
cover = asos.cloud_eigths(clouds)
print(cover)  # Output: [1, 3, 8]
```

---

## API Call Example

A sample API URL constructed by the class might look like:

```
https://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?
&data=tmpf,dwpf,drct,sknt,mslp
&year1=2024&month1=11&day1=1
&year2=2024&month2=11&day2=2
&tz=UTC&format=onlycomma&latlon=yes&elev=yes
&missing=M&direct=no&report_type=3&station=ORD
```

---

## Notes

- Missing values (`'M'`) are automatically replaced with `NaN`.
- The class attempts to cast all numerical fields to `float` where possible.
- Default download includes essential meteorological parameters (temperature, dewpoint, wind direction, wind speed, and MSLP).

---

## License

This code is released for educational and research purposes.  
Please credit the **Iowa Environmental Mesonet (IEM)** as the data source.

---
